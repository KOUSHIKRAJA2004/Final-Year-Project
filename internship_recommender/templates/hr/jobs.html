{% extends "base.html" %}

{% block title %}Job Postings - HR Portal{% endblock %}

{% block content %}
<div class="with-sidebar">
  <div class="sidebar">
    <h2>HR Portal</h2>
    <nav>
      <ul>
        <li><a href="/hr/dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
        <li><a href="/hr/candidates"><i class="fas fa-users"></i> Candidates</a></li>
        <li><a href="/hr/jobs" class="active"><i class="fas fa-briefcase"></i> Job Postings</a></li>
        <li><a href="/logout"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
      </ul>
    </nav>
  </div>

  <div class="main-content">
    <div class="top-nav">
      <h1>Job Postings</h1>
      <div style="display: flex; align-items: center; gap: 1rem;">
        <div class="user-avatar">
          {{ (user.full_name or user.username)[0]|upper if user else 'H' }}
        </div>
      </div>
    </div>
    
    <div class="content">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
        <h2>Manage Job Postings</h2>
        <button onclick="document.getElementById('jobForm').style.display='block'" class="btn">
          <i class="fas fa-plus"></i> Create New Job
        </button>
      </div>

      <!-- Create Job Form -->
      <div id="jobForm" class="card" style="display: none; margin-bottom: 2rem;">
        <h3>Create New Job Posting</h3>
        <form method="POST" action="/hr/jobs">
          <div class="form-group">
            <label>Job Title *</label>
            <input type="text" name="title" required placeholder="e.g., Python Developer">
          </div>
          <div class="form-group">
            <label>Description</label>
            <textarea name="description" rows="4" placeholder="Job description, responsibilities, etc."></textarea>
          </div>
          <div class="form-group">
            <label>Required Skills (comma-separated) *</label>
            <input type="text" name="required_skills" required placeholder="Python, Django, REST API, SQL">
          </div>
          <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
            <div class="form-group">
              <label>Location</label>
              <input type="text" name="location" placeholder="City, State">
            </div>
            <div class="form-group">
              <label>Salary Range (Low) - LPA</label>
              <input type="number" name="salary_low" placeholder="3.0">
            </div>
            <div class="form-group">
              <label>Salary Range (High) - LPA</label>
              <input type="number" name="salary_high" placeholder="6.0">
            </div>
          </div>
          <div style="display: flex; gap: 1rem; margin-top: 1rem;">
            <button type="submit" class="btn">Create Job Posting</button>
            <button type="button" onclick="document.getElementById('jobForm').style.display='none'" class="btn btn-secondary">Cancel</button>
          </div>
        </form>
      </div>

      <!-- Job Postings List -->
      <div class="card">
        <h3>Active Job Postings ({{ job_postings|length }})</h3>
        
        {% if job_postings %}
          <div style="display: grid; gap: 1.5rem; margin-top: 1.5rem;">
            {% for job in job_postings %}
            <div style="border: 1px solid #ddd; border-radius: var(--border-radius); padding: 1.5rem; background: var(--accent);">
              <div style="display: flex; justify-content: space-between; align-items: start; flex-wrap: wrap; gap: 1rem;">
                <div style="flex: 1; min-width: 300px;">
                  <h4 style="margin: 0 0 0.5rem 0; color: var(--primary); font-size: 1.3rem;">
                    {{ job.title }}
                  </h4>
                  {% if job.description %}
                  <p style="margin: 0.5rem 0; color: #666; line-height: 1.6;">
                    {{ job.description[:200] }}{% if job.description|length > 200 %}...{% endif %}
                  </p>
                  {% endif %}
                  {% if job.location %}
                  <p style="margin: 0.5rem 0; color: #666;">
                    <i class="fas fa-map-marker-alt"></i> {{ job.location }}
                  </p>
                  {% endif %}
                  {% if job.salary_range_low and job.salary_range_high %}
                  <p style="margin: 0.5rem 0; color: #666;">
                    <i class="fas fa-rupee-sign"></i> Salary: ₹{{ job.salary_range_low|int / 100000 }} - ₹{{ job.salary_range_high|int / 100000 }} LPA
                  </p>
                  {% endif %}
                  {% if job.required_skills %}
                  <div style="margin-top: 1rem;">
                    <strong>Required Skills:</strong>
                    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 0.5rem;">
                      {% for skill in job.required_skills.split(',') %}
                        <span style="background: #667eea; color: white; padding: 0.35rem 0.75rem; border-radius: 20px; font-size: 0.85rem;">{{ skill.strip() }}</span>
                      {% endfor %}
                    </div>
                  </div>
                  {% endif %}
                  <p style="margin-top: 1rem; color: #999; font-size: 0.9rem;">
                    <i class="fas fa-calendar"></i> Posted: {{ job.created_at[:10] if job.created_at else 'N/A' }}
                  </p>
                </div>
                <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                  <a href="/hr/job/{{ job.id }}/match" class="btn">
                    <i class="fas fa-user-check"></i> Match Candidates
                  </a>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
        {% else %}
          <div style="text-align: center; padding: 3rem; color: #999;">
            <i class="fas fa-briefcase" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.3;"></i>
            <p>No job postings yet. Create your first job posting to start matching candidates!</p>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<style>
  .card {
    background: white;
    border-radius: var(--border-radius);
    padding: 1.5rem;
    box-shadow: 0 2px 10px var(--shadow);
  }
</style>
{% endblock %}

